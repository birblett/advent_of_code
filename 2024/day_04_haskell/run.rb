puts File.open("in.txt") { |file, dirs = [-1, 0, 1], total1 = 0, total2 = 0| (board = file.map { |line| line.strip.chars }).each_with_index { |v, x| v.each_with_index { |ch, y, s2 = "A"| ((dirs.each { |dirx| dirs.each { |diry, s1 = ""| (ch == "X" ? ((0..3).each { |i| s1 += board[dirx * i + x][diry * i + y] unless (dirx == 0 and diry == 0) or (ddx = dirx * i + x) < 0 or (ddx) >= board.length or (ddy = diry * i + y) < 0 or (ddy) >= board[x].length }) : (s2 += board[dirx + x][diry + y] unless dirx == 0 or diry == 0 or (dirx + x) < 0 or (dirx + x) >= board.length or (diry + y) < 0 or (diry + y) >= board[x].length)) and (total1 += 1 if s1 == "XMAS") } } and (total2 += 1 if %w[ASSMM AMMSS ASMSM AMSMS].include? s2)) if ch == "X" || ch == "A") } } and [total1, total2] }