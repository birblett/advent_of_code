puts require('matrix')&&[0,10**13].map{|t|File.read("in.txt").split("\n\n").map{|s, a=s.scan(/\d+/).map(&:to_i)|Matrix[a[4..].map{_1+t}]/Matrix[(a[..1]),a[2..3]]}.sum{|s|s.any?{_1!=_1.to_i}?0:3*s[0,0]+s[0,1]}.to_i}