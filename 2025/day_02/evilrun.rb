puts File.open("in.txt") { |f, p1 = (1..10).map { |i| i.even? ? [i, [i / 2]] : [i, []] }.to_h, p2 = (1..10).map { |i| [i, (1..i / 2).filter { |i2| i % i2 == 0 }] }.to_h, invalid = proc { |range, factors| [[range[0].length, (range[0].to_i..[10 ** range[0].length - 1, range[1].to_i].min)], [range[1].length, ([10 ** range[0].length, range[1].to_i].min..range[1].to_i)]].map { |digits, range, found = []| factors[digits].each { |d, current = (range.min / 10 ** (digits - d) - 1), n| (found.push(n) if range.include?(n)) while (n = (0...digits / d - 1).reduce(current += 1) { |summed, _| summed * 10 ** d + current}) <= range.max } and found }.reduce(&:+) }| f.read.split(",").map { _1.split("-") }.reduce([0, 0]) { |out, i| [out[0] + (invalid.(i, p1) | []).sum, out[1] + (invalid.(i, p2) | []).sum] } }