puts File.read("in.txt").scan(/mul\(\d+,\d+\)|don't\(\)|do\(\)/).reduce([d=0,0]){|(a,b),s|[a+(c=s["m"]?s.scan(/\d+/).map(&:to_i).reduce(&:*):(d=!s["'"])?0:0),d ? b+c:b]}